<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="dist/xterm.css">
    <script src="dist/xterm.js"></script>
    <script src="dist/addons/attach/attach.js"></script>
    <meta charset="UTF-8">
    <title>test</title>
</head>
<body>
<div id="terminal"></div>
<script>
        var term
        var terminalContainer = document.getElementById('terminal')
        var websocket = new WebSocket('ws://127.0.0.1:3000/term');
        function ab2str(buf) {
          return String.fromCharCode.apply(null, new Uint8Array(buf));
        }
        websocket.binaryType = "arraybuffer";
        websocket.onopen = function(evt){
            term = new Terminal();
            term.on('data', function(data) {
                websocket.send(new TextEncoder().encode(data));
            });
            term.open(terminalContainer, true);
            websocket.onmessage = function(evt) {
                if (evt.data instanceof ArrayBuffer) {
                        term.write(ab2str(evt.data));
                } else {
                        alert(evt.data)
                }
            }
            term.attachCustomKeyEventHandler(function (e) {
                if (e.keyCode == 9) {
                    websocket.send("\x09")
                    return false;
                }
            });
            websocket.onclose = function(evt) {
                term.write("Session terminated");
                term.destroy();
            }
            websocket.onerror = function(evt) {
                if (typeof console.log == "function") {
                        console.log(evt)
                }
            }
        }
</script>
</body>
</html>